{"ast":null,"code":"// attio.js\nconst ATTIO_API_BASE = \"https://api.attio.com/v2\";\nconst BEARER_TOKEN = \"Bearer e01cca9d5d70d62535755e3f1609118082790728f8c98dbd0b3f9cce1aae3f53\"; // replace in .env or securely\n\nasync function sendToAttio(structuredUpdates) {\n  for (const item of structuredUpdates) {\n    try {\n      switch (item.type) {\n        case \"person\":\n          await upsertPerson(item);\n          break;\n        case \"task\":\n          await createTask(item);\n          break;\n        default:\n          console.warn(\"❓ Unhandled item type:\", item);\n      }\n    } catch (err) {\n      console.error(\"❌ Failed to send item:\", item, err);\n    }\n  }\n}\nasync function upsertPerson(data) {\n  const [firstName, ...rest] = (data.name || \"Unknown\").split(\" \");\n  const lastName = rest.join(\" \");\n  const payload = {\n    data: {\n      properties: {\n        first_name: firstName,\n        last_name: lastName,\n        notes: data.notes || \"\"\n      }\n    }\n  };\n  const response = await fetch(`${ATTIO_API_BASE}/objects/3a190831-e061-4b7f-af02-644a2ff25c04/records`, {\n    method: \"POST\",\n    headers: {\n      \"Authorization\": BEARER_TOKEN,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(payload)\n  });\n  const result = await response.json();\n  if (response.ok) {\n    var _result$data;\n    console.log(\"✅ Created/Updated Person:\", result);\n    return (_result$data = result.data) === null || _result$data === void 0 ? void 0 : _result$data.id; // record ID\n  } else {\n    console.error(\"❌ Person create error:\", result);\n    return null;\n  }\n}\nasync function createTask(data) {\n  if (!data.description || !data.due_date) {\n    console.warn(\"⚠️ Missing task description or due date.\");\n    return;\n  }\n\n  // Try linking to person by name if provided\n  let personRecordId = null;\n  if (data.link_to_person_name) {\n    personRecordId = await findPersonRecordIdByName(data.link_to_person_name);\n  }\n  const payload = {\n    data: {\n      content: data.description,\n      format: 'plaintext',\n      deadline_at: new Date(data.due_date).toISOString(),\n      is_completed: false,\n      linked_records: personRecordId ? [{\n        target_object: \"people\",\n        target_record_id: personRecordId\n      }] : [],\n      assignees: [] // optionally insert yourself later\n    }\n  };\n  const response = await fetch(`${ATTIO_API_BASE}/tasks`, {\n    method: \"POST\",\n    headers: {\n      \"Authorization\": BEARER_TOKEN,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(payload)\n  });\n  const result = await response.json();\n  if (response.ok) {\n    console.log(\"✅ Task created:\", result);\n  } else {\n    console.error(\"❌ Task creation failed:\", result);\n  }\n}\nasync function findPersonRecordIdByName(name) {\n  if (!name) return null;\n  const response = await fetch(`${ATTIO_API_BASE}/objects/3a190831-e061-4b7f-af02-644a2ff25c04/records`, {\n    method: \"GET\",\n    headers: {\n      \"Authorization\": BEARER_TOKEN\n    }\n  });\n  const json = await response.json();\n  const match = json.data.find(entry => {\n    var _entry$properties, _entry$properties2;\n    const fullName = (((_entry$properties = entry.properties) === null || _entry$properties === void 0 ? void 0 : _entry$properties.first_name) || '') + ' ' + (((_entry$properties2 = entry.properties) === null || _entry$properties2 === void 0 ? void 0 : _entry$properties2.last_name) || '');\n    return fullName.toLowerCase() === name.toLowerCase();\n  });\n  return (match === null || match === void 0 ? void 0 : match.id) || null;\n}\nexport { sendToAttio };","map":{"version":3,"names":["ATTIO_API_BASE","BEARER_TOKEN","sendToAttio","structuredUpdates","item","type","upsertPerson","createTask","console","warn","err","error","data","firstName","rest","name","split","lastName","join","payload","properties","first_name","last_name","notes","response","fetch","method","headers","body","JSON","stringify","result","json","ok","_result$data","log","id","description","due_date","personRecordId","link_to_person_name","findPersonRecordIdByName","content","format","deadline_at","Date","toISOString","is_completed","linked_records","target_object","target_record_id","assignees","match","find","entry","_entry$properties","_entry$properties2","fullName","toLowerCase"],"sources":["/Users/Aditya/ConversationalAI_CRM_Attio/src/attio.js"],"sourcesContent":["// attio.js\nconst ATTIO_API_BASE = \"https://api.attio.com/v2\";\nconst BEARER_TOKEN = \"Bearer e01cca9d5d70d62535755e3f1609118082790728f8c98dbd0b3f9cce1aae3f53\"; // replace in .env or securely\n\n\nasync function sendToAttio(structuredUpdates) {\n  for (const item of structuredUpdates) {\n    try {\n      switch (item.type) {\n        case \"person\":\n          await upsertPerson(item);\n          break;\n        case \"task\":\n          await createTask(item);\n          break;\n        default:\n          console.warn(\"❓ Unhandled item type:\", item);\n      }\n    } catch (err) {\n      console.error(\"❌ Failed to send item:\", item, err);\n    }\n  }\n}\n\nasync function upsertPerson(data) {\n  const [firstName, ...rest] = (data.name || \"Unknown\").split(\" \");\n  const lastName = rest.join(\" \");\n  \n  const payload = {\n    data: {\n      properties: {\n        first_name: firstName,\n        last_name: lastName,\n        notes: data.notes || \"\",\n      }\n    }\n  };\n\n  const response = await fetch(`${ATTIO_API_BASE}/objects/3a190831-e061-4b7f-af02-644a2ff25c04/records`, {\n    method: \"POST\",\n    headers: {\n      \"Authorization\": BEARER_TOKEN,\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(payload),\n  });\n\n  const result = await response.json();\n  if (response.ok) {\n    console.log(\"✅ Created/Updated Person:\", result);\n    return result.data?.id; // record ID\n  } else {\n    console.error(\"❌ Person create error:\", result);\n    return null;\n  }\n}\n\nasync function createTask(data) {\n  if (!data.description || !data.due_date) {\n    console.warn(\"⚠️ Missing task description or due date.\");\n    return;\n  }\n\n  // Try linking to person by name if provided\n  let personRecordId = null;\n  if (data.link_to_person_name) {\n    personRecordId = await findPersonRecordIdByName(data.link_to_person_name);\n  }\n\n  const payload = {\n    data: {\n      content: data.description,\n      format: 'plaintext',\n      deadline_at: new Date(data.due_date).toISOString(),\n      is_completed: false,\n      linked_records: personRecordId ? [\n        { target_object: \"people\", target_record_id: personRecordId }\n      ] : [],\n      assignees: [] // optionally insert yourself later\n    }\n  };\n\n  const response = await fetch(`${ATTIO_API_BASE}/tasks`, {\n    method: \"POST\",\n    headers: {\n      \"Authorization\": BEARER_TOKEN,\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(payload),\n  });\n\n  const result = await response.json();\n  if (response.ok) {\n    console.log(\"✅ Task created:\", result);\n  } else {\n    console.error(\"❌ Task creation failed:\", result);\n  }\n}\n\nasync function findPersonRecordIdByName(name) {\n  if (!name) return null;\n  const response = await fetch(`${ATTIO_API_BASE}/objects/3a190831-e061-4b7f-af02-644a2ff25c04/records`, {\n    method: \"GET\",\n    headers: {\n      \"Authorization\": BEARER_TOKEN,\n    }\n  });\n\n  const json = await response.json();\n  const match = json.data.find((entry) => {\n    const fullName = (entry.properties?.first_name || '') + ' ' + (entry.properties?.last_name || '');\n    return fullName.toLowerCase() === name.toLowerCase();\n  });\n\n  return match?.id || null;\n}\n\nexport { sendToAttio };"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}