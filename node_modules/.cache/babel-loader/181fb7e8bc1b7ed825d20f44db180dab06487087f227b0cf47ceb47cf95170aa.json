{"ast":null,"code":"// attio.js\nconst ATTIO_API_BASE = \"https://api.attio.com/v2\";\nconst BEARER_TOKEN = \"Bearer e01cca9d5d70d62535755e3f1609118082790728f8c98dbd0b3f9cce1aae3f53\"; // replace in .env or securely\n\nlet objectMap = {}; // e.g., { person: 'obj_xxx' }\nlet attributeMap = {}; // e.g., { person: { name: 'attr_xxx' } }\n\nasync function fetchObjectsAndAttributes() {\n  const objRes = await fetch(`${ATTIO_API_BASE}/objects`, {\n    headers: {\n      Authorization: BEARER_TOKEN\n    }\n  });\n  const objData = await objRes.json();\n  for (const obj of objData.data) {\n    if (!obj.label) continue;\n    const label = obj.label.toLowerCase();\n    objectMap[label] = obj.id;\n    console.log(`üì¶ Found object: ${label} ‚Üí ${obj.id}`);\n    const attrRes = await fetch(`${ATTIO_API_BASE}/objects/${obj.id}/attributes`, {\n      headers: {\n        Authorization: BEARER_TOKEN\n      }\n    });\n    const attrData = await attrRes.json();\n    attributeMap[label] = {};\n    for (const attr of attrData.data) {\n      const key = attr.label.toLowerCase().replace(/\\s+/g, '_');\n      attributeMap[label][key] = attr.id;\n      console.log(`  ‚Ü≥ ${label} attr: ${key} ‚Üí ${attr.id}`);\n    }\n  }\n}\nasync function sendToAttio(updates) {\n  if (!Object.keys(objectMap).length) {\n    await fetchObjectsAndAttributes();\n  }\n  for (const item of updates) {\n    try {\n      switch (item.type) {\n        case \"person\":\n          await upsertPerson(item);\n          break;\n        case \"task\":\n          await createTask(item);\n          break;\n        case \"deal\":\n          await updateDeal(item);\n          break;\n        case \"competitor\":\n          await createCompetitor(item);\n          break;\n        default:\n          console.warn(\"Unknown item type:\", item);\n      }\n    } catch (err) {\n      console.error(\"‚ùå Failed to send item:\", item, err);\n    }\n  }\n}\nasync function upsertPerson(data) {\n  const id = objectMap[\"person\"];\n  const attrs = attributeMap[\"person\"];\n  if (!id || !attrs) return;\n  const values = {};\n  const [first, last] = (data.name || \"Unknown\").split(\" \");\n  if (attrs.first_name) values[attrs.first_name] = first;\n  if (attrs.last_name) values[attrs.last_name] = last || \"\";\n  if (data.notes && attrs.notes) values[attrs.notes] = data.notes;\n  if (data.priority && attrs.priority) values[attrs.priority] = data.priority;\n  await fetch(`${ATTIO_API_BASE}/objects/${id}/records`, {\n    method: \"POST\",\n    headers: {\n      Authorization: BEARER_TOKEN,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      values\n    })\n  });\n}\nasync function createTask(data) {\n  if (!data.description || !data.due_date) {\n    console.warn(\"Missing required task fields\");\n    return;\n  }\n  const payload = {\n    data: {\n      content: data.description,\n      format: 'plaintext',\n      deadline_at: new Date(data.due_date).toISOString(),\n      // Ensures correct format\n      is_completed: false,\n      linked_records: [],\n      // required, even if empty\n      assignees: [] // required, even if empty\n    }\n  };\n  const response = await fetch(\"https://api.attio.com/v2/tasks\", {\n    method: \"POST\",\n    headers: {\n      \"Authorization\": `Bearer ${process.env.ATTIO_API_KEY}`,\n      // or your hardcoded key\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(payload)\n  });\n  const result = await response.json();\n  console.log(\"‚úÖ Task Created:\", result);\n  return result;\n}\nasync function updateDeal(data) {\n  const id = objectMap[\"deal\"];\n  const attrs = attributeMap[\"deal\"];\n  if (!id || !attrs) return;\n  const values = {};\n  if (data.value && attrs.value) values[attrs.value] = data.value;\n  if (data.close_date && attrs.close_date) values[attrs.close_date] = data.close_date;\n  if (data.forecast_confidence && attrs.forecast_confidence) values[attrs.forecast_confidence] = data.forecast_confidence;\n  if (data.pain_points && attrs.pain_points) values[attrs.pain_points] = data.pain_points;\n  if (data.decision_maker && attrs.decision_maker) values[attrs.decision_maker] = data.decision_maker;\n  await fetch(`${ATTIO_API_BASE}/objects/${id}/records`, {\n    method: \"POST\",\n    headers: {\n      Authorization: BEARER_TOKEN,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      values\n    })\n  });\n}\nasync function createCompetitor(data) {\n  const id = objectMap[\"competitor\"];\n  const attrs = attributeMap[\"competitor\"];\n  if (!id || !attrs) return;\n  const values = {};\n  if (attrs.name) values[attrs.name] = data.name;\n  await fetch(`${ATTIO_API_BASE}/objects/${id}/records`, {\n    method: \"POST\",\n    headers: {\n      Authorization: BEARER_TOKEN,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      values\n    })\n  });\n}\nexport { sendToAttio };","map":{"version":3,"names":["ATTIO_API_BASE","BEARER_TOKEN","objectMap","attributeMap","fetchObjectsAndAttributes","objRes","fetch","headers","Authorization","objData","json","obj","data","label","toLowerCase","id","console","log","attrRes","attrData","attr","key","replace","sendToAttio","updates","Object","keys","length","item","type","upsertPerson","createTask","updateDeal","createCompetitor","warn","err","error","attrs","values","first","last","name","split","first_name","last_name","notes","priority","method","body","JSON","stringify","description","due_date","payload","content","format","deadline_at","Date","toISOString","is_completed","linked_records","assignees","response","process","env","ATTIO_API_KEY","result","value","close_date","forecast_confidence","pain_points","decision_maker"],"sources":["/Users/Aditya/ConversationalAI_CRM_Attio/src/attio.js"],"sourcesContent":["// attio.js\nconst ATTIO_API_BASE = \"https://api.attio.com/v2\";\nconst BEARER_TOKEN = \"Bearer e01cca9d5d70d62535755e3f1609118082790728f8c98dbd0b3f9cce1aae3f53\"; // replace in .env or securely\n\nlet objectMap = {};       // e.g., { person: 'obj_xxx' }\nlet attributeMap = {};    // e.g., { person: { name: 'attr_xxx' } }\n\nasync function fetchObjectsAndAttributes() {\n  const objRes = await fetch(`${ATTIO_API_BASE}/objects`, {\n    headers: { Authorization: BEARER_TOKEN },\n  });\n  const objData = await objRes.json();\n\n  for (const obj of objData.data) {\n    if (!obj.label) continue;\n    const label = obj.label.toLowerCase();\n    objectMap[label] = obj.id;\n    console.log(`üì¶ Found object: ${label} ‚Üí ${obj.id}`);\n\n    const attrRes = await fetch(`${ATTIO_API_BASE}/objects/${obj.id}/attributes`, {\n      headers: { Authorization: BEARER_TOKEN },\n    });\n    const attrData = await attrRes.json();\n    attributeMap[label] = {};\n\n    for (const attr of attrData.data) {\n      const key = attr.label.toLowerCase().replace(/\\s+/g, '_');\n      attributeMap[label][key] = attr.id;\n      console.log(`  ‚Ü≥ ${label} attr: ${key} ‚Üí ${attr.id}`);\n    }\n  }\n}\n\nasync function sendToAttio(updates) {\n  if (!Object.keys(objectMap).length) {\n    await fetchObjectsAndAttributes();\n  }\n\n  for (const item of updates) {\n    try {\n      switch (item.type) {\n        case \"person\":\n          await upsertPerson(item);\n          break;\n        case \"task\":\n          await createTask(item);\n          break;\n        case \"deal\":\n          await updateDeal(item);\n          break;\n        case \"competitor\":\n          await createCompetitor(item);\n          break;\n        default:\n          console.warn(\"Unknown item type:\", item);\n      }\n    } catch (err) {\n      console.error(\"‚ùå Failed to send item:\", item, err);\n    }\n  }\n}\n\nasync function upsertPerson(data) {\n  const id = objectMap[\"person\"];\n  const attrs = attributeMap[\"person\"];\n  if (!id || !attrs) return;\n\n  const values = {};\n  const [first, last] = (data.name || \"Unknown\").split(\" \");\n\n  if (attrs.first_name) values[attrs.first_name] = first;\n  if (attrs.last_name) values[attrs.last_name] = last || \"\";\n  if (data.notes && attrs.notes) values[attrs.notes] = data.notes;\n  if (data.priority && attrs.priority) values[attrs.priority] = data.priority;\n\n  await fetch(`${ATTIO_API_BASE}/objects/${id}/records`, {\n    method: \"POST\",\n    headers: {\n      Authorization: BEARER_TOKEN,\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({ values }),\n  });\n}\n\nasync function createTask(data) {\n  if (!data.description || !data.due_date) {\n    console.warn(\"Missing required task fields\");\n    return;\n  }\n\n  const payload = {\n    data: {\n      content: data.description,\n      format: 'plaintext',\n      deadline_at: new Date(data.due_date).toISOString(), // Ensures correct format\n      is_completed: false,\n      linked_records: [], // required, even if empty\n      assignees: []       // required, even if empty\n    }\n  };\n\n  const response = await fetch(\"https://api.attio.com/v2/tasks\", {\n    method: \"POST\",\n    headers: {\n      \"Authorization\": `Bearer ${process.env.ATTIO_API_KEY}`, // or your hardcoded key\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(payload),\n  });\n\n  const result = await response.json();\n  console.log(\"‚úÖ Task Created:\", result);\n  return result;\n}\n\n\n\nasync function updateDeal(data) {\n  const id = objectMap[\"deal\"];\n  const attrs = attributeMap[\"deal\"];\n  if (!id || !attrs) return;\n\n  const values = {};\n  if (data.value && attrs.value) values[attrs.value] = data.value;\n  if (data.close_date && attrs.close_date) values[attrs.close_date] = data.close_date;\n  if (data.forecast_confidence && attrs.forecast_confidence) values[attrs.forecast_confidence] = data.forecast_confidence;\n  if (data.pain_points && attrs.pain_points) values[attrs.pain_points] = data.pain_points;\n  if (data.decision_maker && attrs.decision_maker) values[attrs.decision_maker] = data.decision_maker;\n\n  await fetch(`${ATTIO_API_BASE}/objects/${id}/records`, {\n    method: \"POST\",\n    headers: {\n      Authorization: BEARER_TOKEN,\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({ values }),\n  });\n}\n\nasync function createCompetitor(data) {\n  const id = objectMap[\"competitor\"];\n  const attrs = attributeMap[\"competitor\"];\n  if (!id || !attrs) return;\n\n  const values = {};\n  if (attrs.name) values[attrs.name] = data.name;\n\n  await fetch(`${ATTIO_API_BASE}/objects/${id}/records`, {\n    method: \"POST\",\n    headers: {\n      Authorization: BEARER_TOKEN,\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({ values }),\n  });\n}\n\nexport { sendToAttio };"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}